<!DOCTYPE html>
<html lang="en">
  <head>
    <title>
        Rabbit Mq - YTTE Site
      </title>
        <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    
    <meta name="theme-color" content="#000000" />
    
    <meta http-equiv="window-target" content="_top" />
    
    
    <meta name="description" content="" />
    <meta name="generator" content="Hugo 0.95.0 with theme pure" />
    <title>Rabbit Mq - YTTE Site</title>
    
    
    <link rel="stylesheet" href="https://gb.ytte.top/css/style.min.52539b052050345189e34ff8fa6d1921c56f731df70a62d5984b6b2e8826d6e9.css">
    
    <link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/9.15.10/styles/monokai.min.css" async>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css" async>
    <meta property="og:title" content="Rabbit Mq" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://gb.ytte.top/2022/03/22/rabbit-mq/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-22T13:31:53+08:00" />
<meta property="article:modified_time" content="2022-03-22T13:31:53+08:00" />

<meta itemprop="name" content="Rabbit Mq">
<meta itemprop="description" content=""><meta itemprop="datePublished" content="2022-03-22T13:31:53+08:00" />
<meta itemprop="dateModified" content="2022-03-22T13:31:53+08:00" />
<meta itemprop="wordCount" content="8940">
<meta itemprop="keywords" content="Rabbit Mq," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Rabbit Mq"/>
<meta name="twitter:description" content=""/>

    <!--[if lte IE 9]>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
      <![endif]-->

    <!--[if lt IE 9]>
        <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
      <![endif]-->
  </head>

  
  

  <body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader">
    <div class="slimContent">
      <div class="navbar-header">
        <div class="profile-block text-center">
          <a id="avatar" href="https://github.com/YTTE-jx" target="_blank">
            <img class="img-circle img-rotate" src="https://gb.ytte.top/avatar.png" width="200" height="200">
          </a>
          <h2 id="name" class="hidden-xs hidden-sm">YTTE</h2>
          <h3 id="title" class="hidden-xs hidden-sm hidden-md">努力奋斗，不负韶华。</h3>
          <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i>Anhui, China</small>
        </div><div class="search" id="search-form-wrap">
    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="Search" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i
                        class="icon icon-search"></i></button>
            </span>
        </div>
        <div class="ins-search">
            <div class="ins-search-mask"></div>
            <div class="ins-search-container">
                <div class="ins-input-wrapper">
                    <input type="text" class="ins-search-input" placeholder="Type something..."
                        x-webkit-speech />
                    <button type="button" class="close ins-close ins-selectable" data-dismiss="modal"
                        aria-label="Close"><span aria-hidden="true">×</span></button>
                </div>
                <div class="ins-section-wrapper">
                    <div class="ins-section-container"></div>
                </div>
            </div>
        </div>
    </form>
</div>
        <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
      </div>
      <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
        <ul class="nav navbar-nav main-nav">
            <li class="menu-item menu-item-home">
                <a href="/">
                    <i class="icon icon-home-fill"></i>
                  <span class="menu-title">Home</span>
                </a>
            </li>
            <li class="menu-item menu-item-archives">
                <a href="/posts/">
                    <i class="icon icon-archives-fill"></i>
                  <span class="menu-title">Archives</span>
                </a>
            </li>
            <li class="menu-item menu-item-categories">
                <a href="/categories/">
                    <i class="icon icon-folder"></i>
                  <span class="menu-title">Categories</span>
                </a>
            </li>
            <li class="menu-item menu-item-tags">
                <a href="/tags/">
                    <i class="icon icon-tags"></i>
                  <span class="menu-title">Tags</span>
                </a>
            </li>
            <li class="menu-item menu-item-about">
                <a href="/about/">
                    <i class="icon icon-cup-fill"></i>
                  <span class="menu-title">About</span>
                </a>
            </li>
        </ul>
      </nav>
    </div>
  </header>

<aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">Board</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content"><p> 人生无常，大肠包小肠~</p>
            </div>
        </div>
    </div>
</div>

      <div class="widget">
    <h3 class="widget-title"> Tags</h3>
    <div id="tag-cloud-list" class="widget-body">
            
            
            <a href="https://gb.ytte.top/tags/bolg/" class="tag-list-link" rel="1">bolg<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://gb.ytte.top/tags/docker/" class="tag-list-link" rel="1">docker<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://gb.ytte.top/tags/git/" class="tag-list-link" rel="1">git<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://gb.ytte.top/tags/gitee/" class="tag-list-link" rel="2">gitee<span
               class="tag-list-count">2</span></a>
            
            
            <a href="https://gb.ytte.top/tags/github/" class="tag-list-link" rel="1">github<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://gb.ytte.top/tags/hexo/" class="tag-list-link" rel="1">hexo<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://gb.ytte.top/tags/https/" class="tag-list-link" rel="1">https<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://gb.ytte.top/tags/hugo/" class="tag-list-link" rel="1">hugo<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://gb.ytte.top/tags/index/" class="tag-list-link" rel="1">index<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://gb.ytte.top/tags/jvm/" class="tag-list-link" rel="1">jvm<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://gb.ytte.top/tags/mysql/" class="tag-list-link" rel="3">mysql<span
               class="tag-list-count">3</span></a>
            
            
            <a href="https://gb.ytte.top/tags/rabbit-mq/" class="tag-list-link" rel="1">rabbit-mq<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://gb.ytte.top/tags/springboot/" class="tag-list-link" rel="1">springboot<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://gb.ytte.top/tags/springcloud/" class="tag-list-link" rel="1">springcloud<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://gb.ytte.top/tags/thread/" class="tag-list-link" rel="1">thread<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://gb.ytte.top/tags/typora/" class="tag-list-link" rel="1">typora<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://gb.ytte.top/tags/zookeeper/" class="tag-list-link" rel="1">zookeeper<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://gb.ytte.top/tags/%E5%9F%9F%E5%90%8D/" class="tag-list-link" rel="2">域名<span
               class="tag-list-count">2</span></a>
            
            
            <a href="https://gb.ytte.top/tags/%E5%9F%BA%E7%A1%80/" class="tag-list-link" rel="3">基础<span
               class="tag-list-count">3</span></a>
            
            
            <a href="https://gb.ytte.top/tags/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/" class="tag-list-link" rel="1">谷粒商城<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://gb.ytte.top/tags/%E9%A2%98%E7%9B%AE/" class="tag-list-link" rel="1">题目<span
               class="tag-list-count">1</span></a>
            
    </div>
<script>
document.onreadystatechange = () => {
  if (document.readyState === 'complete') {
    tagCloud('#tag-cloud-list a',  8 ,  20 );
  }
};

function tagCloud(where, min, max) {
  let iMax = 0;
  let iMin = 0;
  $(where).each(function() {
    let weight = Number($(this).attr("rel"));
    if(iMax < weight) iMax = weight;
    if(iMin > weight || iMin == 0) iMin = weight;
  });
  let step = (max - min)/(iMax - iMin);
  $(where).each(function() {
    let weight = $(this).attr("rel") - iMin;
    $(this).css({"font-size": min + (weight * step) + 'px'});
  });
};
</script>
</div>

      <div class="widget">
    <h3 class="widget-title"> Categories</h3>
    <div class="widget-body">
        <ul class="category-list">
            <li class="category-list-item"><a href="https://gb.ytte.top/categories/bolg/" class="category-list-link">bolg</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://gb.ytte.top/categories/git/" class="category-list-link">git</a><span class="category-list-count">2</span></li>
            <li class="category-list-item"><a href="https://gb.ytte.top/categories/java/" class="category-list-link">java</a><span class="category-list-count">6</span></li>
            <li class="category-list-item"><a href="https://gb.ytte.top/categories/jvm/" class="category-list-link">jvm</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://gb.ytte.top/categories/zookeeper/" class="category-list-link">zookeeper</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://gb.ytte.top/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" class="category-list-link">数据库</a><span class="category-list-count">3</span></li>
            <li class="category-list-item"><a href="https://gb.ytte.top/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/" class="category-list-link">服务器</a><span class="category-list-count">5</span></li>
            <li class="category-list-item"><a href="https://gb.ytte.top/categories/%E6%9D%82%E9%A1%B9/" class="category-list-link">杂项</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://gb.ytte.top/categories/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" class="category-list-link">消息队列</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://gb.ytte.top/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" class="category-list-link">计算机网络</a><span class="category-list-count">3</span></li>
            <li class="category-list-item"><a href="https://gb.ytte.top/categories/%E9%A1%B9%E7%9B%AE/" class="category-list-link">项目</a><span class="category-list-count">1</span></li>
        </ul>
    </div>
</div>
      
<div class="widget">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget-body">
        <ul class="recent-post-list list-unstyled no-thumbnail">
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://gb.ytte.top/2022/03/31/mysql-exercises-and-summaries/" class="title">Mysql Exercises and Summaries</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2022-03-31 21:49:37 &#43;0800 CST" itemprop="datePublished">2022-03-31</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://gb.ytte.top/2022/03/24/mysql%E5%9F%BA%E7%A1%80/" class="title">MySql基础</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2022-03-24 16:49:54 &#43;0800 CST" itemprop="datePublished">2022-03-24</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://gb.ytte.top/2022/03/24/mysql%E9%AB%98%E7%BA%A7/" class="title">MySql高级</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2022-03-24 16:49:54 &#43;0800 CST" itemprop="datePublished">2022-03-24</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://gb.ytte.top/2022/03/22/rabbit-mq/" class="title">Rabbit Mq</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2022-03-22 13:31:53 &#43;0800 CST" itemprop="datePublished">2022-03-22</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://gb.ytte.top/2022/03/22/docker/" class="title">Docker</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2022-03-22 13:31:01 &#43;0800 CST" itemprop="datePublished">2022-03-22</time>
                    </p>
                </div>
            </li>
        </ul>
    </div>
</div>
  </div>
</aside>

    
    
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <h4 class="toc-title">Catalogue</h4>
    <nav id="toc" class="js-toc toc">

    </nav>
  </div>
</aside>
<main class="main" role="main"><div class="content">
  <article id="-" class="article article-type-" itemscope
    itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      <h1 itemprop="name">
  <a
    class="article-title"
    href="/2022/03/22/rabbit-mq/"
    >Rabbit Mq</a
  >
</h1>

      <div class="article-meta">
        
<span class="article-date">
  <i class="icon icon-calendar-check"></i>&nbsp;
<a href="https://gb.ytte.top/2022/03/22/rabbit-mq/" class="article-date">
  <time datetime="2022-03-22 13:31:53 &#43;0800 CST" itemprop="datePublished">2022-03-22</time>
</a>
</span>
<span class="article-category">
  <i class="icon icon-folder"></i>&nbsp;
  <a class="article-category-link" href="/categories/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"> 消息队列 </a>
  <a class="article-category-link" href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/"> 服务器 </a>
</span>  
  <span class="article-tag">
    <i class="icon icon-tags"></i>&nbsp;
    <a class="article-tag-link" href="/tags/rabbit-mq/"> Rabbit Mq </a>
  </span>

		<span class="post-wordcount hidden-xs" itemprop="wordCount">Word Count: 8940 words</span>
		<span class="post-readcount hidden-xs" itemprop="timeRequired">Read Time: 18 minutes </span>
      </div>
    </div>
    <div class="article-entry marked-body js-toc-content" itemprop="articleBody">
      <h1 id="消息队列">消息队列</h1>
<h2 id="mq-的相关概念">MQ 的相关概念</h2>
<h2 id="rabbitmq">RabbitMQ</h2>
<h3 id="概念">概念</h3>
<p>RabbitMQ是一个消息中间件：它接受并转发消息。可以把它当做一个<strong>快递站点</strong>，当你要发送一个包裹时，你把你的包裹放到快递站，快递员最终会把你的快递送到收件人那里，按照这种逻辑RabbitMQ是一个快递站，一个快递员帮你传递快件。RabbitMQ与快递站的主要区别在于，它不处理快件而是==接收==，==存储==和==转发消息数据==。</p>
<h3 id="四大核心">四大核心</h3>
<ul>
<li>
<p>生产者：</p>
<p>产生数据发送消息的程序是生产者</p>
</li>
<li>
<p>交换机：</p>
<p>交换机是 RabbitMQ 非常重要的一个部件，一方面它接收来自生产者的消息，另一方面它将消息推送到队列中。交换机必须确切知道如何处理它接收到的消息，是将这些消息推送到特定队列还是推送到多个队列，亦或者是把消息丢弃，这个得有交换机类型决定</p>
</li>
<li>
<p>队列：</p>
<p>队列是 RabbitMQ 内部使用的一种数据结构，尽管消息流经 RabbitMQ 和应用程序，但它们只能存储在队列中。队列仅受主机的内存和磁盘限制的约束，本质上是一个大的消息缓冲区。许多生产者可以将消息发送到一个队列，许多消费者可以尝试从一个队列接收数据。这就是我们使用队列的方式</p>
</li>
<li>
<p>消费者：</p>
<p>消费与接收具有相似的含义。消费者大多时候是一个等待接收消息的程序。请注意生产者，消费者和消息中间件很多时候并不在同一机器上。同一个应用程序既可以是生产者又是可以是消费者。</p>
<p><img src="https://blogimg.ytte.top//img-jixiang/2022/03/24/160651528.png" alt=""></p>
<p><img src="https://blogimg.ytte.top//img-jixiang/2022/03/26/215243797.png" alt=""></p>
</li>
</ul>
<h3 id="核心模式">核心模式</h3>
<ol>
<li>[Hello World——简单模式](##hello  world)</li>
<li>[Work Queue——工作模式](##工作队列 Work Queue)</li>
<li>Publish/Subscribe——发布/订阅模式</li>
<li>Routing——路由模式</li>
<li>Topics——主题模式</li>
<li>Publisher Confirms——发布确认模式</li>
</ol>
<p><img src="https://blogimg.ytte.top//img-jixiang/2022/03/26/215204940.png" alt=""></p>
<h3 id="关键词">关键词</h3>
<p><img src="https://blogimg.ytte.top//img-jixiang/2022/03/25/223117896.png" alt=""></p>
<ul>
<li><strong>Broker</strong>：接收和分发消息的应用，RabbitMQ Server 就是 Message Broker</li>
<li><strong>Virtual host</strong>：出于多租户和安全因素设计的，把 AMQP 的基本组件划分到一个虚拟的分组中，类似于网络中的 namespace 概念。当多个不同的用户使用同一个 RabbitMQ server 提供的服务时，可以划分出多个 vhost，每个用户在自己的 vhost 创建exchange／queue 等</li>
<li><strong>Connection</strong>：publisher／consumer 和 broker 之间的 TCP 连接</li>
<li><strong>Channel</strong>：如果每一次访问 RabbitMQ 都建立一个 Connection，在消息量大的时候建立 TCPConnection 的开销将是巨大的，效率也较低。Channel 是在 connection 内部建立的逻辑连接，如果应用程序支持多线程，通常每个 thread 创建单独的 channel 进行通讯，AMQP method 包含了 channel id 帮助客户端和 message broker 识别 channel，所以 channel 之间是完全隔离的。<strong>Channel 作为轻量级的Connection 极大减少了操作系统建立 TCP connection 的开销</strong></li>
<li><strong>Exchange</strong>：message 到达 broker 的第一站，根据分发规则，匹配查询表中的 routing key，分发消息到 queue 中去。常用的类型有：==direct== (point-to-point), ==topic== (publish-subscribe) and==fanout==(multicast)</li>
<li><strong>Queue</strong>：消息最终被送到这里等待 consumer 取走</li>
<li><strong>Binding</strong>：exchange 和 queue 之间的虚拟连接，binding 中可以包含 routing key，Binding 信息被保存到 exchange 中的查询表中，用于 message 的分发依据</li>
</ul>
<h3 id="安装">安装</h3>
<h4 id="非docker方式">非docker方式</h4>
<ol>
<li>
<p><a href="https://www.rabbitmq.com/download.html">官方网址</a></p>
</li>
<li>
<p>文件上传</p>
<p>上传到/usr/local/software 目录下(如果没有 software 需要自己创建)</p>
<p><img src="https://blogimg.ytte.top//img-jixiang/2022/03/26/000129273.png" alt=""></p>
<p>链接：https://pan.baidu.com/s/1UTJhAesjTjQl3rl-v9MZBw  提取码：ytte &ndash;来自百度网盘超级的分享</p>
</li>
<li>
<p>安装文件(分别按照以下顺序安装)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>rpm -ivh erlang-21.3-1.el7.x86_64.rpm  <span style="color:#75715e">#rabbitmq的前置erlang的环境</span>
</span></span><span style="display:flex;"><span>yum install socat -y           <span style="color:#75715e">#官网要求安装</span>
</span></span><span style="display:flex;"><span>rpm -ivh rabbitmq-server-3.8.8-1.el7.noarch.rpm     <span style="color:#75715e">#rabbitmq-server</span>
</span></span></code></pre></div></li>
<li>
<p>常用命令(按照以下顺序执行)</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>chkconfig rabbitmq-server on</code></td>
<td>添加开机启动 RabbitMQ 服务</td>
</tr>
<tr>
<td><code>/sbin/service rabbitmq-server start</code></td>
<td>启动服务</td>
</tr>
<tr>
<td><code>/sbin/service rabbitmq-server status</code></td>
<td>查看服务状态</td>
</tr>
<tr>
<td><code>/sbin/service rabbitmq-server stop</code></td>
<td>停止服务(选择执行)</td>
</tr>
<tr>
<td><code>rabbitmq-plugins enable rabbitmq_management</code></td>
<td>开启 web 管理插件</td>
</tr>
</tbody>
</table>
<p><img src="https://blogimg.ytte.top//img-jixiang/2022/03/26/000513867.png" alt=""></p>
<p>开启web管理插件的时候需要停止服务，开启web管理插件后需要手动再次启动rabbitmq服务。</p>
</li>
<li>
<p>linux防火墙开启端口</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>firewall-cmd --zone<span style="color:#f92672">=</span>public --add-port<span style="color:#f92672">=</span>5672/tcp --permanent      <span style="color:#75715e">#开启5672端口  程序代码执行所需端口</span>
</span></span><span style="display:flex;"><span>firewall-cmd --zone<span style="color:#f92672">=</span>public --add-port<span style="color:#f92672">=</span>15672/tcp --permanent		<span style="color:#75715e">#开启15672端口  web插件所需端口</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>firewall-cmd --reload											<span style="color:#75715e">#防火墙重启</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>firewall-cmd --zone<span style="color:#f92672">=</span>public --list-ports							<span style="color:#75715e">#查看开放的端口</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>systemctl status firewalld										<span style="color:#75715e">#查看防火墙状态</span>
</span></span></code></pre></div></li>
<li>
<p>云服务器开启15672和5672端口</p>
<p>用默认账号密码(guest)访问地址 http://ip:15672/出现权限问题</p>
</li>
<li>
<p>出现权限问题是因为guest设置了超级管理员角色，但是没有被赋予权限。</p>
<p>添加一个新的用户：</p>
<table>
<thead>
<tr>
<th style="text-align:center">序号</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1</td>
<td><code>rabbitmqctl add_user admin 123</code></td>
<td>创建账号</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td><code>rabbitmqctl set_user_tags admin administrator</code></td>
<td>设置用户角色</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td><code>rabbitmqctl set_permissions -p &quot;/&quot; admin &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</code></td>
<td>设置用户权限</td>
</tr>
<tr>
<td style="text-align:center">3.1</td>
<td>set_permissions [-p <!-- raw HTML omitted -->] <!-- raw HTML omitted --> <!-- raw HTML omitted --> <!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>用户 user_admin 具有/vhost1 这个 virtual host 中所有资源的配置、写、读权限</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td><code> rabbitmqctl list_users</code></td>
<td>显示当前用户和角色</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>再次利用 admin 用户登录</p>
</li>
<li>
<p>重置命令</p>
<ul>
<li>关闭应用的命令为：<code>rabbitmqctl stop_app</code></li>
<li>清除的命令为：<code>rabbitmqctl reset</code></li>
<li>重新启动命令为：<code>rabbitmqctl start_app</code></li>
</ul>
</li>
</ol>
<h4 id="docker安装">docker安装</h4>
<ol>
<li>
<p>pull</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>docker pull rabbitmq
</span></span></code></pre></div></li>
<li>
<p>run</p>
<p>15672端口</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>docker run -d --name myrabbitmq  -p 15672:15672 -p 5672:5672 rabbitmq
</span></span></code></pre></div></li>
<li>
<p>增加超级管理员用户，开启web插件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>docker ps 
</span></span><span style="display:flex;"><span>docker exec -it 容器ID /bin/bash
</span></span><span style="display:flex;"><span>rabbitmqctl add_user admin 123					<span style="color:#75715e">#创建账号</span>
</span></span><span style="display:flex;"><span>rabbitmqctl set_user_tags admin administrator  <span style="color:#75715e">#设置用户角色</span>
</span></span><span style="display:flex;"><span>rabbitmqctl set_permissions -p <span style="color:#e6db74">&#34;/&#34;</span> admin <span style="color:#e6db74">&#34;.*&#34;</span> <span style="color:#e6db74">&#34;.*&#34;</span> <span style="color:#e6db74">&#34;.*&#34;</span>  <span style="color:#75715e">#用户 user_admin 具有/vhost1 这个 virtual host 中所有资源的配置、写、读权限</span>
</span></span><span style="display:flex;"><span>rabbitmqctl list_users                          <span style="color:#75715e">#显示当前用户和角色</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>rabbitmq-plugins enable rabbitmq_management      <span style="color:#75715e">#开启web插件</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ctrl+p+q    <span style="color:#75715e">#退出当前容器</span>
</span></span></code></pre></div></li>
<li>
<p>重启容器</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>docker restart  容器ID
</span></span></code></pre></div></li>
<li>
<p>linux防火墙开启端口</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>firewall-cmd --zone<span style="color:#f92672">=</span>public --add-port<span style="color:#f92672">=</span>5672/tcp --permanent      <span style="color:#75715e">#开启5672端口</span>
</span></span><span style="display:flex;"><span>firewall-cmd --zone<span style="color:#f92672">=</span>public --add-port<span style="color:#f92672">=</span>15672/tcp --permanent		<span style="color:#75715e">#开启15672端口</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>firewall-cmd --reload											<span style="color:#75715e">#防火墙重启</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>firewall-cmd --zone<span style="color:#f92672">=</span>public --list-ports							<span style="color:#75715e">#查看开放的端口</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>systemctl status firewalld										<span style="color:#75715e">#查看防火墙状态</span>
</span></span></code></pre></div></li>
<li>
<p>云服务器开启15672和5672端口</p>
</li>
<li>
<p>登陆网页查看</p>
</li>
</ol>
<h1 id="hello--world">hello  world</h1>
<p>用 Java 编写两个程序。发送单个消息的生产者和接收消息并打印出来的消费者。</p>
<p>在下图中，“ P”是我们的生产者，“ C”是我们的消费者。中间的框是一个队列-RabbitMQ 代表使用者保留的消息缓冲区</p>
<p><img src="https://blogimg.ytte.top//img-jixiang/2022/03/26/123228234.png" alt=""></p>
<ul>
<li>
<p>pom依赖：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span> <span style="color:#75715e">&lt;!--指定 jdk 编译版本--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;build&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;plugins&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;plugin&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&lt;groupId&gt;</span>org.apache.maven.plugins<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&lt;artifactId&gt;</span>maven-compiler-plugin<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&lt;configuration&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&lt;source&gt;</span>8<span style="color:#f92672">&lt;/source&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&lt;target&gt;</span>8<span style="color:#f92672">&lt;/target&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&lt;/configuration&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;/plugin&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/plugins&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/build&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;dependencies&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&lt;!--rabbitmq 依赖客户端--&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;groupId&gt;</span>com.rabbitmq<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;artifactId&gt;</span>amqp-client<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;version&gt;</span>5.8.0<span style="color:#f92672">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&lt;!--操作文件流的一个依赖--&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;groupId&gt;</span>commons-io<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;artifactId&gt;</span>commons-io<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;version&gt;</span>2.6<span style="color:#f92672">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/dependencies&gt;</span>
</span></span></code></pre></div></li>
<li>
<p>消息的生产者</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Producer</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//队列名称常量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">static</span> String QUEUE_NAME <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;hello&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//创建一个连接工厂
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        ConnectionFactory connectionFactory <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ConnectionFactory<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        connectionFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">setHost</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;101.35.136.150&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        connectionFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">setUsername</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ytte&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        connectionFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">setPassword</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ytte&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//channel 实现了自动 close 接口 自动关闭 不需要显示关闭
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            Connection  connection <span style="color:#f92672">=</span> connectionFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">newConnection</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            Channel channel <span style="color:#f92672">=</span> connection<span style="color:#f92672">.</span><span style="color:#a6e22e">createChannel</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			 * 生成一个队列
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			 * 1.队列名称
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			 * 2.队列里面的消息是否持久化 默认消息存储在内存中
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			 * 3.该队列是否只供一个消费者进行消费 是否进行共享 false 可以多个消费者消费
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			 *    （如果设置成了true）只有队列能接收到消息，消费者也接受不到消息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			 * 4.是否自动删除 最后一个消费者端开连接以后 该队列是否自动删除 true 自动删除
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			 * 5.其他参数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			 */</span>	
</span></span><span style="display:flex;"><span>            channel<span style="color:#f92672">.</span><span style="color:#a6e22e">queueDeclare</span><span style="color:#f92672">(</span>QUEUE_NAME<span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            String message <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;hello world&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			 * 发送一个消息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			 * 1.发送到那个交换机
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			 * 2.路由的 key 是哪个
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			 * 3.其他的参数信息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			 * 4.发送消息的消息体
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			 */</span>
</span></span><span style="display:flex;"><span>            channel<span style="color:#f92672">.</span><span style="color:#a6e22e">basicPublish</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">,</span>QUEUE_NAME<span style="color:#f92672">,</span><span style="color:#66d9ef">null</span><span style="color:#f92672">,</span>message<span style="color:#f92672">.</span><span style="color:#a6e22e">getBytes</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;消息发送完毕&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IOException <span style="color:#f92672">|</span> TimeoutException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
<li>
<p>消息的消费者</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Consumer</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">static</span> String QUEUE_NAME <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;hello&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        ConnectionFactory connectionFactory <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ConnectionFactory<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        connectionFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">setHost</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;101.35.136.150&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        connectionFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">setUsername</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ytte&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        connectionFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">setPassword</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ytte&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;等待接收消息。。。。。。。。&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            Connection connection <span style="color:#f92672">=</span> connectionFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">newConnection</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            Channel channel <span style="color:#f92672">=</span> connection<span style="color:#f92672">.</span><span style="color:#a6e22e">createChannel</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//推送的消息如何进行消费的接口回调
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            DeliverCallback deliverCallback <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>consumerTag<span style="color:#f92672">,</span> message<span style="color:#f92672">)</span> <span style="color:#f92672">-&gt;</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> String<span style="color:#f92672">(</span>message<span style="color:#f92672">.</span><span style="color:#a6e22e">getBody</span><span style="color:#f92672">()));</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">};</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//取消消费的一个回调接口 如在消费的时候队列被删除掉了
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            CancelCallback cancelCallback <span style="color:#f92672">=</span> consumerTag <span style="color:#f92672">-&gt;</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;消息消费被中断&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">};</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			 * 消费者消费消息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			 * 1.消费哪个队列
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			 * 2.消费成功之后是否要自动应答 true 代表自动应答 false 手动应答
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			 * 3.消费者未成功消费的回调
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			 */</span>
</span></span><span style="display:flex;"><span>            channel<span style="color:#f92672">.</span><span style="color:#a6e22e">basicConsume</span><span style="color:#f92672">(</span>QUEUE_NAME<span style="color:#f92672">,</span><span style="color:#66d9ef">true</span><span style="color:#f92672">,</span>deliverCallback<span style="color:#f92672">,</span>cancelCallback<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IOException <span style="color:#f92672">|</span> TimeoutException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
</ul>
<h1 id="工作队列-work-queue">工作队列 Work Queue</h1>
<p><img src="https://blogimg.ytte.top//img-jixiang/2022/03/27/093053298.png" alt=""></p>
<p>工作队列(又称任务队列)的主要思想是避免立即执行资源密集型任务，而不得不等待它完成。我们把任务发送到队列。==当有多个工作线程时，这些工作线程将一起处理这些任务。每个消息任务只能被完整的执行一次，如果一个消费者工作线程断开连接，他正在处理的消息任务会返回队列中，并由其他消费者工作线程来执行，所以说是只能被<strong>完整</strong>的执行一次。==</p>
<h2 id="轮循分发消息">轮循分发消息</h2>
<p>即，如果存在两个消费者工作线程，消息会轮流分发给二者，你一个我一个。</p>
<h3 id="抽取工具类">抽取工具类</h3>
<p>重复代码太多抽取工具类</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RabbitMqUtils</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//得到一个连接的 channel
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> Channel <span style="color:#a6e22e">getChannel</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//创建一个连接工厂
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        ConnectionFactory factory <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ConnectionFactory<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        factory<span style="color:#f92672">.</span><span style="color:#a6e22e">setHost</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;101.35.136.150&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        factory<span style="color:#f92672">.</span><span style="color:#a6e22e">setUsername</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ytte&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        factory<span style="color:#f92672">.</span><span style="color:#a6e22e">setPassword</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ytte&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        Connection connection <span style="color:#f92672">=</span> factory<span style="color:#f92672">.</span><span style="color:#a6e22e">newConnection</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> connection<span style="color:#f92672">.</span><span style="color:#a6e22e">createChannel</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h3 id="消费者">消费者</h3>
<p>不创建多个进行，使用idea自带的单一类可创建多实例。</p>
<p><img src="https://blogimg.ytte.top//img-jixiang/2022/03/27/113514233.png" alt=""></p>
<p>这样就可以多次启动WorkQueue1，且可更改其中的代码在启动（将C1 消费者启动改为C2 消费者启动）</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">WorkQueue1</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String QUEUE_NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;hello&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Channel channel <span style="color:#f92672">=</span> RabbitMqUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">getChannel</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        DeliverCallback deliverCallback<span style="color:#f92672">=(</span>consumerTag<span style="color:#f92672">,</span> delivery<span style="color:#f92672">)-&gt;{</span>
</span></span><span style="display:flex;"><span>            String receivedMessage <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> String<span style="color:#f92672">(</span>delivery<span style="color:#f92672">.</span><span style="color:#a6e22e">getBody</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;接收到消息:&#34;</span><span style="color:#f92672">+</span>receivedMessage<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">};</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        CancelCallback cancelCallback<span style="color:#f92672">=(</span>consumerTag<span style="color:#f92672">)-&gt;{</span>
</span></span><span style="display:flex;"><span>            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>consumerTag<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;消费者取消消费接口回调逻辑&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">};</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;C1 消费者启动等待消费.................. &#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        channel<span style="color:#f92672">.</span><span style="color:#a6e22e">basicConsume</span><span style="color:#f92672">(</span>QUEUE_NAME<span style="color:#f92672">,</span><span style="color:#66d9ef">true</span><span style="color:#f92672">,</span>deliverCallback<span style="color:#f92672">,</span>cancelCallback<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h3 id="生产者">生产者</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Task01</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String QUEUE_NAME <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;hello&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">(</span>Channel channel <span style="color:#f92672">=</span> RabbitMqUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">getChannel</span><span style="color:#f92672">();)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            channel<span style="color:#f92672">.</span><span style="color:#a6e22e">queueDeclare</span><span style="color:#f92672">(</span>QUEUE_NAME<span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//从控制台当中接受信息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            Scanner scanner <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Scanner<span style="color:#f92672">(</span>System<span style="color:#f92672">.</span><span style="color:#a6e22e">in</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>scanner<span style="color:#f92672">.</span><span style="color:#a6e22e">hasNext</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                String message <span style="color:#f92672">=</span> scanner<span style="color:#f92672">.</span><span style="color:#a6e22e">next</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>                channel<span style="color:#f92672">.</span><span style="color:#a6e22e">basicPublish</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">,</span> QUEUE_NAME<span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">,</span> message<span style="color:#f92672">.</span><span style="color:#a6e22e">getBytes</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>                System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;发送消息完成:&#34;</span> <span style="color:#f92672">+</span> message<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h3 id="结果">结果</h3>
<p><img src="https://blogimg.ytte.top//img-jixiang/2022/03/27/114037303.png" alt=""></p>
<h2 id="消息应答">消息应答</h2>
<p>RabbitMQ 一旦向消费者传递了一条消息，便立即将该消息标记为删除。在这种情况下，突然有个消费者挂掉了，我们将丢失正在处理的消息。以及后续发送给该消费这的消息，因为它无法接收到。</p>
<p>为了保证消息在发送过程中不丢失，rabbitmq 引入消息应答机制，消息应答就是：消费者在接收到消息并且处理该消息之后，告诉 rabbitmq 它已经处理了，rabbitmq 可以把该消息删除了。</p>
<ol>
<li><strong>自动应答</strong></li>
<li><strong>手动应答</strong></li>
</ol>
<h3 id="自动应答">自动应答</h3>
<p>消息发送后立即被认为已经传送成功，这种模式需要在高吞吐量和数据传输安全性方面做权衡，因为如果消息在接收到之前，消费者出现连接或者 channel 关闭，那么消息就丢失了；虽然这种模式消费者可以传递过载的消息，但是这样有可能使得消费者由于接收太多还来不及处理的消息，造成消息的积压，内存耗尽，最终这些消费者线程被操作系统杀死。<strong>所以自动应答仅适用在消费者可以高效并以某种速率能够处理这些消息的情况下使用。</strong></p>
<p>一般不采用自动应答，采用手动应答。</p>
<h3 id="手动应答">手动应答</h3>
<p>常用方法：</p>
<ul>
<li>
<p><code>Channel.basicAck</code>(用于肯定确认)</p>
<p>RabbitMQ 已知道该消息并且成功的处理消息，可以将其丢弃了</p>
</li>
<li>
<p><code>Channel.basicNack</code>(用于否定确认)</p>
</li>
<li>
<p><code>Channel.basicReject</code>(用于否定确认)</p>
<p>与 Channel.basicNack 相比少一个参数，不处理该消息了直接拒绝，可以将其丢弃了</p>
</li>
</ul>
<p><strong>手动应答的好处是可以批量应答并且减少网络拥堵</strong></p>
<p><img src="https://blogimg.ytte.top//img-jixiang/2022/03/27/161332400.png" alt=""></p>
<p>批量应答即，消息在消费者的对应的信道中，还未被接受也会被消费者回复收到应答给RabbitMq。</p>
<h3 id="消息自动重新入队">消息自动重新入队</h3>
<p>如果消费者由于某些原因失去连接(其通道已关闭，连接已关闭或 TCP 连接丢失)，导致消息未发送 ACK 确认，RabbitMQ 将了解到消息未完全处理，并将对其重新排队。如果此时其他消费者可以处理，它将很快将其重新分发给另一个消费者。这样，即使某个消费者偶尔死亡，也可以确保不会丢失任何消息。</p>
<p><img src="https://blogimg.ytte.top/img-jixiang/2022/03/27/%E6%B6%88%E6%81%AF%E9%87%8D%E5%85%A5%E9%98%9F.gif" alt="消息重入队列"></p>
<h3 id="消息手动应答代码">消息手动应答代码</h3>
<p>生产者：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Task02</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String TASK_QUEUE_NAME <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ack_queue&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> argv<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">(</span>Channel channel <span style="color:#f92672">=</span> RabbitMqUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">getChannel</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            channel<span style="color:#f92672">.</span><span style="color:#a6e22e">queueDeclare</span><span style="color:#f92672">(</span>TASK_QUEUE_NAME<span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            Scanner sc <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Scanner<span style="color:#f92672">(</span>System<span style="color:#f92672">.</span><span style="color:#a6e22e">in</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;请输入信息&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>sc<span style="color:#f92672">.</span><span style="color:#a6e22e">hasNext</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                String message <span style="color:#f92672">=</span> sc<span style="color:#f92672">.</span><span style="color:#a6e22e">nextLine</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>                channel<span style="color:#f92672">.</span><span style="color:#a6e22e">basicPublish</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">,</span> TASK_QUEUE_NAME<span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">,</span> message<span style="color:#f92672">.</span><span style="color:#a6e22e">getBytes</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;UTF-8&#34;</span><span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>                System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;生产者发出消息&#34;</span> <span style="color:#f92672">+</span> message<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>消费者1：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Work01</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String ACK_QUEUE_NAME <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ack_queue&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        Channel channel <span style="color:#f92672">=</span> RabbitMqUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">getChannel</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;C1 等待接收消息处理时间较短&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//消息消费的时候如何处理消息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        DeliverCallback deliverCallback <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>consumerTag<span style="color:#f92672">,</span> delivery<span style="color:#f92672">)-&gt;</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            String message <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> String<span style="color:#f92672">(</span>delivery<span style="color:#f92672">.</span><span style="color:#a6e22e">getBody</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e">// 睡眠1s
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            SleepUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">sleep</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;接收到消息:&#34;</span> <span style="color:#f92672">+</span> message<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * 1.消息标记 tag
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * 2.是否批量应答未应答消息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             */</span>
</span></span><span style="display:flex;"><span>            channel<span style="color:#f92672">.</span><span style="color:#a6e22e">basicAck</span><span style="color:#f92672">(</span>delivery<span style="color:#f92672">.</span><span style="color:#a6e22e">getEnvelope</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getDeliveryTag</span><span style="color:#f92672">(),</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">};</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//采用手动应答
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        channel<span style="color:#f92672">.</span><span style="color:#a6e22e">basicConsume</span><span style="color:#f92672">(</span>ACK_QUEUE_NAME<span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> deliverCallback<span style="color:#f92672">,</span> <span style="color:#f92672">(</span>consumerTag<span style="color:#f92672">)</span> <span style="color:#f92672">-&gt;</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>consumerTag <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;消费者取消消费接口回调逻辑&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">});</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>消费者2：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Work02</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String ACK_QUEUE_NAME <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ack_queue&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        Channel channel <span style="color:#f92672">=</span> RabbitMqUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">getChannel</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;C2 等待接收消息处理时间较短&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//消息消费的时候如何处理消息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        DeliverCallback deliverCallback <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>consumerTag<span style="color:#f92672">,</span> delivery<span style="color:#f92672">)-&gt;</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            String message <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> String<span style="color:#f92672">(</span>delivery<span style="color:#f92672">.</span><span style="color:#a6e22e">getBody</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e">//睡眠20s表示正在处理还多的代码
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            SleepUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">sleep</span><span style="color:#f92672">(</span>20<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;接收到消息:&#34;</span> <span style="color:#f92672">+</span> message<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * 1.消息标记 tag
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * 2.是否批量应答未应答消息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             */</span>
</span></span><span style="display:flex;"><span>            channel<span style="color:#f92672">.</span><span style="color:#a6e22e">basicAck</span><span style="color:#f92672">(</span>delivery<span style="color:#f92672">.</span><span style="color:#a6e22e">getEnvelope</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getDeliveryTag</span><span style="color:#f92672">(),</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">};</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//采用手动应答
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        channel<span style="color:#f92672">.</span><span style="color:#a6e22e">basicConsume</span><span style="color:#f92672">(</span>ACK_QUEUE_NAME<span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> deliverCallback<span style="color:#f92672">,</span> <span style="color:#f92672">(</span>consumerTag<span style="color:#f92672">)</span> <span style="color:#f92672">-&gt;</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>consumerTag <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;消费者取消消费接口回调逻辑&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">});</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>SleepUtils：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SleepUtils</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">sleep</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> second<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            Thread<span style="color:#f92672">.</span><span style="color:#a6e22e">sleep</span><span style="color:#f92672">(</span>1000 <span style="color:#f92672">*</span> second<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>InterruptedException _ignored<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            Thread<span style="color:#f92672">.</span><span style="color:#a6e22e">currentThread</span><span style="color:#f92672">().</span><span style="color:#a6e22e">interrupt</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h4 id="效果">效果</h4>
<p>生产者发送1~9，消费者工作线程轮流接受消息，1和2中平均接收到消息，但是由于1中睡眠1s，2中睡眠20s，所以可以看出2对应的信道里还屯留了几条消息（不知道是否可以这样说），而1中马上就处理完了。这时候我们关闭2进程，这就导致没有处理消息，或者没有处理完成，也就没有发送应答，Rabbit会检查到没有接收到应答消息，将未处理的消息交个能处理它们的1中，1继续处理消息。</p>
<p><img src="https://blogimg.ytte.top//img-jixiang/2022/03/27/163239250.png" alt=""></p>
<p><img src="https://blogimg.ytte.top//img-jixiang/2022/03/27/163738781.png" alt=""></p>
<p><img src="https://blogimg.ytte.top//img-jixiang/2022/03/27/163819058.png" alt=""></p>
<p><img src="https://blogimg.ytte.top//img-jixiang/2022/03/27/164047802.png" alt=""></p>
<p><img src="https://blogimg.ytte.top//img-jixiang/2022/03/27/163900870.png" alt=""></p>
<hr>
<p>2022-3-30</p>
<h2 id="rabbitmq-持久化">RabbitMQ 持久化</h2>
<p>保障当 RabbitMQ 服务停掉以后消息生产者发送过来的消息不丢失。默认情况下 RabbitMQ 退出或由于某种原因崩溃时，它忽视队列和消息，除非告知它不要这样做。我们需要==将队列和消息都标记为持久化==。</p>
<h3 id="队列如何实现持久化">队列如何实现持久化</h3>
<p>==队列实现持久化 需要在声明队列的时候把 durable 参数设置为持久化==</p>
<p><img src="https://blogimg.ytte.top//img-jixiang/2022/03/30/171611056.png" alt=""></p>
<p>注意：<strong>之前声明的不是持久化的队列，需要把原先队列先删除，或者重新创建一个持久化的队列，不然就会出现错误</strong></p>
<p><img src="https://blogimg.ytte.top//img-jixiang/2022/03/30/171656509.png" alt=""></p>
<p>控制台中持久化与非持久化队列的 UI 显示区：</p>
<p><img src="https://blogimg.ytte.top//img-jixiang/2022/03/30/171802268.png" alt=""></p>
<p>现在即使重启 rabbitmq 队列也依然存在。</p>
<h3 id="消息实现持久化">消息实现持久化</h3>
<p>==消息持久化需要在消息生产者修改代码，<code>MessageProperties.PERSISTENT_TEXT_PLAIN</code>添加这个属性。==</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>channel<span style="color:#f92672">.</span><span style="color:#a6e22e">basicPublish</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">,</span> TASK_QUEUE_NAME<span style="color:#f92672">,</span> MessageProperties<span style="color:#f92672">.</span><span style="color:#a6e22e">PERSISTENT_TEXT_PLAIN</span><span style="color:#f92672">,</span> message<span style="color:#f92672">.</span><span style="color:#a6e22e">getBytes</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;UTF-8&#34;</span><span style="color:#f92672">));</span>
</span></span></code></pre></div><p><img src="https://blogimg.ytte.top//img-jixiang/2022/03/30/175234018.png" alt=""></p>
<p>将消息标记为持久化并不能完全保证不会丢失消息。尽管它告诉 RabbitMQ 将消息保存到磁盘，但是这里依然存在当消息刚准备存储在磁盘的时候 但是还没有存储完，消息还在缓存的一个间隔点。此时并没有真正写入磁盘。后面的发布确认章节，会细说如何让生产者收到确认的消息。（生产者收到确认消息，即消息已经 到达队列并且持久化了）</p>
<h3 id="不公平分发">不公平分发</h3>
<p>之前的轮流分发在某种场景下不是好的方法，比方说有两个消费者在处理任务，二者处理速度不同，任务是平分的，就会造成一方消费者空闲 一方忙活。不能够最大化利用现有资源。</p>
<p>为了避免这种情况，我们可以设置参数</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>channel<span style="color:#f92672">.</span><span style="color:#a6e22e">basicQos</span><span style="color:#f92672">(</span>1<span style="color:#f92672">)</span>
</span></span></code></pre></div><p>在web页面中可以看到Prefetch count 为1，即上面设置的参数为1</p>
<p><img src="https://blogimg.ytte.top//img-jixiang/2022/03/30/200811871.png" alt=""></p>
<p>如果我还没有处理完或者我还没有应答你，你先别分配给我，我目前只能处理一个任务，然后 rabbitmq 就会把该任务分配给没有那么忙的那个空闲消费者，当然如果所有的消费者都没有完成手上任务，队列还在不停的添加新任务，队列有可能就会遇到队列被撑满的情况，这个时候就只能添加新的 worker 或者改变其他存储任务的策略。</p>
<h3 id="预取值">预取值</h3>
<p>==就相当于channel中有个缓冲区，缓冲区的大小（所能暂存消息的数量）可以通过使用 basic.Qos “预取计数”值来设置。该值定义通道上允许的未确认消息的最大数量。一旦数量达到配置的数量，RabbitMQ 将停止在通道上传递更多消息。==</p>
<p>例如，假设在通道上有未确认的消息 5、6、7，8，预取值设置为 4，此时RabbitMQ 将不会在该通道上再传递任何
消息。若 排在前面的消息 刚刚被确认 ACK，RabbitMQ 才会再发送消息。消息应答和 QoS 预取值对用户吞吐量有重大影响。</p>
<p>通常，增加预取值，来提高向消费者传递消息的速度。虽然自动应答传输消息速率是最佳的，但是，在这种情况下已传递但尚未处理的消息的数量也会增加，不同的负载该值取值也不同 100 到 300 范围内的值通常可提供最佳的吞吐量，并且不会给消费者带来太大的风险。预取值为 1 是最保守的。</p>
<h1 id="发布确认">发布确认</h1>
<h2 id="原理">原理</h2>
<p>生产者将信道设置成 confirm 模式，所有在该信道上面发布的消息都将会被指派一个唯一的 ID(从 1 开始)，消息被投递到所有匹配的队列之后，mq就会发送一个确认信息给生产者(包含消息的唯一 ID)，告诉生产者消息已经正确到达目的队列了。</p>
<p>如果<strong>消息</strong>和<strong>队列</strong>是可持久化的，那么确认消息会在将消息写入磁盘之后发出，mq回传给生产者的确认消息中的delivery-tag 属性，包含了确认消息的序列号，此外 broker 也可以设置basic.ack 的multiple 属性，表示到这个序列号之前的所有消息都已经得到了处理。</p>
<p>confirm 模式最大的好处在于可以是异步的，发布一条消息，生产者应用程序就可以在等信道返回确认的同时继续发送下一条消息，当消息最终得到确认之后，生产者应用便可以通过回调方法来处理该确认消息，如果 RabbitMQ 因为自身内部错误导致消息丢失，就会发送一条 nack 消息，生产者应用程序同样可以在回调方法中处理该 nack 消息。</p>
<hr>
<p>2022-3-31</p>
<h2 id="开启发布确认的方法">开启发布确认的方法</h2>
<p><strong>开启需要调用方法 confirmSelect，每当你要想使用发布确认，都需要在 channel 上调用该方法</strong></p>
<p><img src="https://blogimg.ytte.top//img-jixiang/2022/03/31/093413329.png" alt=""></p>
<h2 id="单个确认发布">单个确认发布</h2>
<p>这是一种简单的确认方式，==同步确认发布的方式==，发布一个消息之后只有它被确认发布，后续的消息才能继续发布，<code>waitForConfirmsOrDie(long)</code>这个方法只有在消息被确认的时候才返回(返回布尔值)，如果在指定时间范围内这个消息没有被确认那么它将抛出异常。</p>
<p>缺点：==发布速度特别的慢==，因为如果==没有收到确认发布的消息就会阻塞所有后续消息==的发布，这种方式最多提供每秒不超过数百条发布消息的吞吐量。适用简单和小应用程序。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">e111</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">int</span> MESSAGE_COUNT <span style="color:#f92672">=</span> 1000<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        publishMessageIndividually<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">publishMessageIndividually</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">(</span>Channel channel <span style="color:#f92672">=</span> RabbitMqUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">getChannel</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//产生随机的队列名
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            String queueName <span style="color:#f92672">=</span> UUID<span style="color:#f92672">.</span><span style="color:#a6e22e">randomUUID</span><span style="color:#f92672">().</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//声明队列
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            channel<span style="color:#f92672">.</span><span style="color:#a6e22e">queueDeclare</span><span style="color:#f92672">(</span>queueName<span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//开启发布确认
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            channel<span style="color:#f92672">.</span><span style="color:#a6e22e">confirmSelect</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">long</span> begin <span style="color:#f92672">=</span> System<span style="color:#f92672">.</span><span style="color:#a6e22e">currentTimeMillis</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//循环1000 发送消息，收到确认信息再发送消息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> MESSAGE_COUNT<span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                String message <span style="color:#f92672">=</span> i <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>                channel<span style="color:#f92672">.</span><span style="color:#a6e22e">basicPublish</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">,</span> queueName<span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">,</span> message<span style="color:#f92672">.</span><span style="color:#a6e22e">getBytes</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>                 <span style="color:#75715e">//等待接受确认信息 服务端返回 false 或超时时间内未返回，生产者可以消息重发
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#66d9ef">boolean</span> flag <span style="color:#f92672">=</span> channel<span style="color:#f92672">.</span><span style="color:#a6e22e">waitForConfirms</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>flag<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;消息发送成功&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">long</span> end <span style="color:#f92672">=</span> System<span style="color:#f92672">.</span><span style="color:#a6e22e">currentTimeMillis</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;发布&#34;</span> <span style="color:#f92672">+</span> MESSAGE_COUNT <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;个单独确认消息,耗时&#34;</span> <span style="color:#f92672">+</span> <span style="color:#f92672">(</span>end <span style="color:#f92672">-</span> begin<span style="color:#f92672">)</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;ms&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//结果  发布1000个单独确认消息,耗时15837ms
</span></span></span></code></pre></div><h2 id="批量确认发布">批量确认发布</h2>
<p>与单个等待确认消息相比，==先发布一批消息然后一起确认==可以极大地提高吞吐量，==缺点：当发生故障导致发布出现问题时，不知道是哪个消息出现问题==，我们必须将整个批处理保存在内存中，以记录重要的信息而后重新发布消息。当然这种方案仍然是==同步的==，也一样阻塞消息的发布。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">BatchPublishMessage</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> <span style="color:#f92672">(</span>Channel channel <span style="color:#f92672">=</span> RabbitMqUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">getChannel</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        String queueName <span style="color:#f92672">=</span> UUID<span style="color:#f92672">.</span><span style="color:#a6e22e">randomUUID</span><span style="color:#f92672">().</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        channel<span style="color:#f92672">.</span><span style="color:#a6e22e">queueDeclare</span><span style="color:#f92672">(</span>queueName<span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        channel<span style="color:#f92672">.</span><span style="color:#a6e22e">confirmSelect</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">long</span> start <span style="color:#f92672">=</span> System<span style="color:#f92672">.</span><span style="color:#a6e22e">currentTimeMillis</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> MESSAGE_COUNT<span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            String message <span style="color:#f92672">=</span> i <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            channel<span style="color:#f92672">.</span><span style="color:#a6e22e">basicPublish</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">,</span> queueName<span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">,</span> message<span style="color:#f92672">.</span><span style="color:#a6e22e">getBytes</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>MESSAGE_COUNT <span style="color:#f92672">%</span> <span style="color:#f92672">(</span>i<span style="color:#f92672">+</span>1<span style="color:#f92672">)</span> <span style="color:#f92672">==</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">boolean</span> b <span style="color:#f92672">=</span> channel<span style="color:#f92672">.</span><span style="color:#a6e22e">waitForConfirms</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>b<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;消息发送成功&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">long</span> end <span style="color:#f92672">=</span> System<span style="color:#f92672">.</span><span style="color:#a6e22e">currentTimeMillis</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;发布&#34;</span> <span style="color:#f92672">+</span> MESSAGE_COUNT <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;个单独确认消息,耗时&#34;</span> <span style="color:#f92672">+</span> <span style="color:#f92672">(</span>end <span style="color:#f92672">-</span> start<span style="color:#f92672">)</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;ms&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//结果 发布1000个单独确认消息,耗时344ms
</span></span></span></code></pre></div><h2 id="异步确认发布">异步确认发布</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">AsynchronousPublishMessage</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> <span style="color:#f92672">(</span>Channel channel <span style="color:#f92672">=</span> RabbitMqUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">getChannel</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        String queueName <span style="color:#f92672">=</span> UUID<span style="color:#f92672">.</span><span style="color:#a6e22e">randomUUID</span><span style="color:#f92672">().</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//开启发布确认
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        channel<span style="color:#f92672">.</span><span style="color:#a6e22e">confirmSelect</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * 线程安全有序的一个哈希表，适用于高并发的情况
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * 1.将序号与消息进行关联
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * 2.批量删除条目 只要给到序列号
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * 3.支持并发访问
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             */</span>
</span></span><span style="display:flex;"><span>        ConcurrentSkipListMap<span style="color:#f92672">&lt;</span>Long<span style="color:#f92672">,</span> String<span style="color:#f92672">&gt;</span> outstandingConfirms <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ConcurrentSkipListMap<span style="color:#f92672">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>       <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * 确认收到消息的一个回调
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * 1.消息序列号
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * 2.multiple
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             *      true 未能收到当前序号的确认消息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             *      false 确认收到当前序号消息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             */</span>
</span></span><span style="display:flex;"><span>      	ConfirmCallback ackCallback <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>sequenceNumber<span style="color:#f92672">,</span> multiple<span style="color:#f92672">)</span> <span style="color:#f92672">-&gt;</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">//只清除当前序列号的消息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>multiple<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    String message <span style="color:#f92672">=</span> outstandingConfirms<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>sequenceNumber<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;发布的消息&#34;</span> <span style="color:#f92672">+</span> message <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;被确认&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                    outstandingConfirms<span style="color:#f92672">.</span><span style="color:#a6e22e">remove</span><span style="color:#f92672">(</span>sequenceNumber<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">};</span>
</span></span><span style="display:flex;"><span>        ConfirmCallback nackCallback <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>sequenceNumber<span style="color:#f92672">,</span> multiple<span style="color:#f92672">)</span> <span style="color:#f92672">-&gt;</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>multiple<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    String message <span style="color:#f92672">=</span> outstandingConfirms<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>sequenceNumber<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;发布的消息&#34;</span><span style="color:#f92672">+</span>message<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;未被确认，序列号&#34;</span><span style="color:#f92672">+</span>sequenceNumber<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">};</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * 添加一个异步确认的监听器
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * 1.确认收到消息的回调
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * 2.未收到消息的回调
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             */</span>
</span></span><span style="display:flex;"><span>        channel<span style="color:#f92672">.</span><span style="color:#a6e22e">addConfirmListener</span><span style="color:#f92672">(</span>ackCallback<span style="color:#f92672">,</span> nackCallback<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">long</span> begin <span style="color:#f92672">=</span> System<span style="color:#f92672">.</span><span style="color:#a6e22e">currentTimeMillis</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> MESSAGE_COUNT<span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            String message <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;消息&#34;</span> <span style="color:#f92672">+</span> i<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                 * channel.getNextPublishSeqNo()获取下一个消息的序列号
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                 * 通过序列号与消息体进行一个关联
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                 * 接收到的确认的，未确认的消息都收集到map中
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                 */</span>
</span></span><span style="display:flex;"><span>            outstandingConfirms<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>channel<span style="color:#f92672">.</span><span style="color:#a6e22e">getNextPublishSeqNo</span><span style="color:#f92672">(),</span> message<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            channel<span style="color:#f92672">.</span><span style="color:#a6e22e">basicPublish</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">,</span> queueName<span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">,</span> message<span style="color:#f92672">.</span><span style="color:#a6e22e">getBytes</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;消息发送成功&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">long</span> end <span style="color:#f92672">=</span> System<span style="color:#f92672">.</span><span style="color:#a6e22e">currentTimeMillis</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;发布&#34;</span> <span style="color:#f92672">+</span> MESSAGE_COUNT <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;个异步确认消息,耗时&#34;</span> <span style="color:#f92672">+</span> <span style="color:#f92672">(</span>end <span style="color:#f92672">-</span> begin<span style="color:#f92672">)</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;ms&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        SleepUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">sleep</span><span style="color:#f92672">(</span>20<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//结果  发布1000个异步确认消息,耗时62ms
</span></span></span></code></pre></div><h3 id="如何处理异步未确认消息">如何处理异步未确认消息</h3>
<p>把未确认的消息放到一个基于内存的能被发布线程访问的队列，比如说用ConcurrentLinkedQueue 这个队列在 confirm callbacks 与发布线程之间进行消息的传递。</p>
<h3 id="对比">对比</h3>
<ul>
<li>
<p>发布1000个单独确认消息,耗时15837ms</p>
</li>
<li>
<p>发布1000个单独确认消息,耗时344ms</p>
</li>
<li>
<p>发布1000个异步确认消息,耗时62ms</p>
</li>
</ul>
<h1 id="交换机">交换机</h1>
<p>在之前，将做一些完全不同的信息传达给多个消费者的模式称为 ”发布/订阅”。为了说明这种模式，我们将构建一个简单的日志系统。由两个程序组成：第一个程序将发出日志消息，第二个程序是消费者。其中我们会启动两个消费者，其中一个消费者接收到消息后把日志存储在磁盘，另外一个消费者接收到消息后把消息打印在屏幕上，事实上第一个程序发出的日志消息将广播给所有消费者。todo（解释的不清晰）。</p>
<p>实际上，生产者只能将消息发送到交换机(exchange)，交换机工作的内容是，一方面接收来自生产者的消息，另一方面将它们推入队列。交换机必须确切知道如何处理收到的消息。是应该把这些消息放到特定队列还是说把他们到许多队列中（这就是发布订阅模式（类似广播）），还是说应该丢弃它们。这些都由交换机的类型来决定。</p>
<p><img src="https://blogimg.ytte.top//img-jixiang/2022/03/31/132735304.png" alt=""></p>
<h2 id="exchanges-的类型">Exchanges 的类型</h2>
<ul>
<li>直接(direct)</li>
<li>主题(topic)</li>
<li>标题(headers)</li>
<li><a href="#fanout">扇出(fanout)</a></li>
</ul>
<h2 id="默认交换机">默认交换机</h2>
<p>填写“”即表示使用默认的交换机。消息能路由发送到队列中其实是由<code>routingKey(bindingkey)</code>绑定 key 指定的</p>
<p><img src="https://blogimg.ytte.top//img-jixiang/2022/03/31/133025313.png" alt=""></p>
<h2 id="临时队列">临时队列</h2>
<p>之前的章节我们使用的是具有特定名称的队列(还记得 hello 和 ack_queue 吗？)。队列的名称我们来说至关重要-我们需要指定我们的消费者去消费哪个队列的消息。每当我们连接到 Rabbit 时，我们都需要一个全新的空队列，为此我们可以创建一个具有随机名称的队列，或者能让服务器为我们选择一个随机队列名称那就更好了。其次一旦我们断开了消费者的连接，队列将被自动删除。创建临时队列的方式如下:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>String queueName <span style="color:#f92672">=</span> channel<span style="color:#f92672">.</span><span style="color:#a6e22e">queueDeclare</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getQueue</span><span style="color:#f92672">();</span>
</span></span></code></pre></div><p>创建出来之后长成这样:</p>
<p><img src="https://blogimg.ytte.top//img-jixiang/2022/04/02/153920239.png" alt=""></p>
<h2 id="绑定bindings">绑定(bindings)</h2>
<p>binding 是 exchange 和 queue 之间的桥梁，表示exchange 和队列进行了绑定关系。比如说下面这张图告诉我们的就是 X 与 Q1 和 Q2 进行了绑定</p>
<p><img src="https://blogimg.ytte.top//img-jixiang/2022/04/02/155056828.png" alt=""></p>
<h2 id="fanout">Fanout</h2>
<p>Fanout 是将接收到的所有消息广播到它知道的所有队列中。系统中默认有些 exchange 类型。</p>
<p><img src="https://blogimg.ytte.top//img-jixiang/2022/04/02/160333798.png" alt=""></p>
<p><img src="https://blogimg.ytte.top//img-jixiang/2022/04/02/160410731.png" alt=""></p>
<p>Logs 和临时队列的绑定关系如下图:</p>
<p><img src="https://blogimg.ytte.top//img-jixiang/2022/04/02/162225607.png" alt=""></p>
<p><!-- raw HTML omitted -->蓝色<!-- raw HTML omitted --></p>
<h1 id="总结">总结</h1>
<p><a href="https://www.zhihu.com/question/34243607/answer/1023686807">消息队列的使用场景</a></p>
<h2 id="分布式事务">分布式事务</h2>
<h2 id="重复消费消息丢失顺序消费">重复消费、消息丢失、顺序消费</h2>
<h2 id="可用性">可用性</h2>
<blockquote>
<p>搞定！</p>
<p>人生无常，大肠包小肠！</p>
<p>继续学习吧！</p>
</blockquote>
    </div>
    <div class="article-footer">
<blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    <li class="post-copyright-link hidden-xs">
      <strong>Permalink: </strong>
      <a href="https://gb.ytte.top/2022/03/22/rabbit-mq/" title="Rabbit Mq" target="_blank" rel="external">https://gb.ytte.top/2022/03/22/rabbit-mq/</a>
    </li>
    <li class="post-copyright-license">
      <strong>License: </strong>
        <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN</a>
    </li>
  </ul>
</blockquote>

<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/YTTE-jx" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="https://gb.ytte.top/avatar.png" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/YTTE-jx" target="_blank"><span class="text-dark">YTTE</span><small class="ml-1x">努力奋斗，不负韶华。</small></a></h3>
        <div>Good Good Study, Day Day Up~</div>
      </div>
    </figure>
  </div>
</div>

    </div>
  </article>
</div><nav class="bar bar-footer clearfix" data-stick-bottom>
    <div class="bar-inner">
        <ul class="pager pull-left">
            <li class="prev">
                <a href="https://gb.ytte.top/2022/03/22/docker/" title="Docker"><i
                        class="icon icon-angle-left"
                        aria-hidden="true"></i><span>&nbsp;&nbsp;Older</span></a>
            </li>
            <li class="next">
                <a href="https://gb.ytte.top/2022/03/24/mysql%E9%AB%98%E7%BA%A7/"
                    title="MySql高级"><span>Newer&nbsp;&nbsp;</span><i
                        class="icon icon-angle-right" aria-hidden="true"></i></a>
            </li>
            
            <li class="toggle-toc">
                <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false"
                    title="Catalogue" role="button">
                    <span>[&nbsp;</span><span>Catalogue</span>
                    <i class="text-collapsed icon icon-anchor"></i>
                    <i class="text-in icon icon-close"></i>
                    <span>]</span>
                </a>
            </li>
        </ul>
        <div class="bar-right">
            <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter"
                data-mobile-sites="weibo,qq,qzone"></div>
        </div>
    </div>
</nav>


</main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
<ul class="social-links">
    <li><a href="https://github.com/YTTE-jx" target="_blank" title="github" data-toggle=tooltip data-placement=top >
            <i class="icon icon-github"></i></a></li>
    <li><a href="https://gb.ytte.top/index.xml" target="_blank" title="rss" data-toggle=tooltip data-placement=top >
            <i class="icon icon-rss"></i></a></li>
</ul>
  <div class="copyright">
    &copy;2022  -
    2022
    <div class="publishby">
        Theme by <a href="https://github.com/xiaoheiAh" target="_blank"> xiaoheiAh </a>base on<a href="https://github.com/xiaoheiAh/hugo-theme-pure" target="_blank"> pure</a>.
    </div>
    
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_SVG"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
            showMathMenu: false, //disables context menu
            tex2jax: {
            inlineMath: [ ['$','$'], ['\\(','\\)'] ]
           }
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
<script>
    window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>
<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/highlight.min.js"></script>
<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/languages/python.min.js" defer></script>
<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/languages/javascript.min.js" defer></script><script>
    hljs.configure({
        tabReplace: '    ', 
        classPrefix: ''     
        
    })
    hljs.initHighlightingOnLoad();
</script>
<script src="https://gb.ytte.top/js/application.min.e720b935330b2a176cfb4b8bd9a6cc632caf6b752f94e87c62152a9557ff6d15.js"></script>
<script src="https://gb.ytte.top/js/plugin.min.334875d4d4a72afb866e446df61b5f4bf1f0a516d1303166f52f7804d17ef3ab.js"></script>

<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            ROOT_URL: 'https:\/\/gb.ytte.top\/',
            CONTENT_URL: 'https:\/\/gb.ytte.top\/\/searchindex.json ',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script type="text/javascript" src="https://gb.ytte.top/js/insight.min.759e5002714e12761afcd512f103d39c86573165db51972dd3b24df6eddf238ed3e3e85c1988e96cba09419d1deccdeb68c15284f2c3d03049fad53c11774524.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
<script>
    tocbot.init({
        
        tocSelector: '.js-toc',
        
        contentSelector: '.js-toc-content',
        
        headingSelector: 'h1, h2, h3',
        
        hasInnerContainers: true,
    });
</script>


  </body>
</html>
